{%  extends "ARLouvreBundle::layout.html.twig" %}

{% block title %}Paiement - {{ parent() }}{%  endblock %}

{% block resaActive %}class="active"{% endblock %}

{% block titleSection %}Paiement des billets :{% endblock %}

{% block body %}

    {# TODO à mettre dans un template#}
    <div class="row resa-info">
        <p class="bg-info text-info text-center  col-sm-4 col-sm-offset-4 col-xs-8 col-xs-offset-2">
            Vous désirez {{ resa.nbBillets }} billet(s) {% if resa.demijournee %}demi-{% endif %}journée pour le {{ resa.dateresa|date("d/m/Y") }}
        </p>
        <a class="btn btn-default col-sm-4 col-sm-offset-4  col-xs-8 col-xs-offset-2" href="{{ path('louvre_resa_completer', {'resaCode': resa.resaCode}) }}">Modifier ma réservation</a>
    </div>

    <div class="row">

        <div class="text-center col-xs-10 col-xs-offset-1">

            <div id="recap-resa">

                <h4>Les billets sont nominatifs et vont être réservés pour les personnes suivantes :</h4>

                <ul id="liste-recap">
                    {% for billet in resa.billets %}
                        <li>
                            <p>
                                {{ billet.nom }} {{ billet.prenom }}, né(e) le {{ billet.dateNaissance|date("d/m/Y") }}, prix de ce billet :
                                {% if resa.demijournee %} {{ billet.prix/2 }} {% else %} {{ billet.prix }} {% endif %}
                                euros.
                                {% if billet.tarifReduit %}
                                    <br><i>Vous devrez présenter votre justificatif tarif réduit à l'entrée.</i>
                                {% endif %}
                            </p>
                        </li>
                    {% endfor %}
                </ul>


                <p><strong>Montant de total de la réservation : <br> {{ resa.prixTotal }} €</strong></p>
            </div>

            <form method="POST">

                <script src="https://checkout.stripe.com/checkout.js"></script>

                <button id="customButton" class="btn btn-primary">Payer par carte bancaire</button>

                <script>
                    var handler = StripeCheckout.configure({
                        key: '{{ public_key }}',
                        image: 'http://scaphandroid.ddns.net/louvre-small.jpg',
                        locale: 'auto',
                        token: function(token) {
                            // You can access the token ID with `token.id`.
                            // Get the token ID to your server-side code for use.
                        }
                    });

                    document.getElementById('customButton').addEventListener('click', function(e) {
                        // Open Checkout with further options:
                        handler.open({
                            name: 'Payez votre réservation',
                            description: 'Vous recevrez vos billets par email',
                            currency: 'eur',
                            amount: {{ resa.prixTotal * 100 }}
                        });
                        e.preventDefault();
                    });

                    // Close Checkout on page navigation:
                    window.addEventListener('popstate', function() {
                        handler.close();
                    });
                </script>
            </form>
        </div>
    </div>

{% endblock %}